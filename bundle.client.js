!function(){"use strict";function e(e,t,n,i){return new(n||(n=Promise))(function(l,o){function c(e){try{d(i.next(e))}catch(e){o(e)}}function s(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){e.done?l(e.value):new n(function(t){t(e.value)}).then(c,s)}d((i=i.apply(e,t||[])).next())})}const t=/["&'<>]/g,n={'"':"&quot;","&":"&amp;","'":"&#39;","<":"&lt;",">":"&gt;"},i=e=>n[e],l=e=>e.replace(t,i);var o=(e,t)=>{if(!t||null==t.column||null==t.line)return l(e)+"\n|";const n=e.split("\n"),i=n[t.line-1],o=t.column+((e=>{const t=e[0];return"'"===t||'"'===t||"`"===t||"/"===t?e.indexOf(t,1)+1||e.length:e.search(/[^a-zA-Z0-9$_]|$/)||1})(i.slice(t.column))||1),c=[...n.slice(0,t.line-1),i.slice(0,t.column)].join("\n"),s=[i.slice(o),...n.slice(t.line)].join("\n"),d=i.slice(t.column,o);return`${l(c)}<span class="highlight">${l(d)}</span>${l(s)}`+"\n|"};let c=0;const s=document.getElementById("input-wrapper"),d=document.getElementById("input-overlay"),u=document.getElementById("input-textarea"),r=document.getElementById("output-wrapper"),a=document.getElementById("output-overlay"),g=document.getElementById("output-textarea"),p=document.getElementById("compress"),m=document.getElementById("mangle"),v=document.getElementById("toplevel"),h=document.getElementById("beautify"),y=document.getElementById("babel"),E=(e=>(t,n)=>{const i=c++;return e.postMessage({key:i,type:t,payload:n}),new Promise(t=>{const n=({data:l})=>{l.key===i&&(t(l.payload),e.removeEventListener("message",n))};e.addEventListener("message",n)})})(new Worker("./bundle.webworker.js")),B=()=>e(void 0,void 0,void 0,function*(){const e=yield E("minify",{code:u.value,useBabel:y.checked,options:{compress:p.checked,mangle:m.checked,toplevel:v.checked,output:{beautify:h.checked},sourceMap:!0}}),t=e.error||e.code;g.value=t,a.innerHTML=o(t),g.style.height=a.clientHeight+"px",d.innerHTML=o(u.value)});let L;const f=()=>e(void 0,void 0,void 0,function*(){if(yield B(),!L)return;const{original:e,generated:t}=yield E("positionFromInput",L);d.innerHTML=o(u.value,e),a.innerHTML=o(g.value,t);const n=a.getElementsByClassName("highlight")[0];if(n){const e=n.getBoundingClientRect().top-a.getBoundingClientRect().top,t=r.clientHeight,i=r.scrollTop,l=i+t-H;(e<i||l<e)&&(r.scrollTop=e-.3*t)}});let T;u.addEventListener("input",()=>{d.innerHTML=o(u.value),u.style.height=d.clientHeight+"px",L=null,clearTimeout(T),T=setTimeout(B,500)}),p.addEventListener("click",f),m.addEventListener("click",f),v.addEventListener("click",f),h.addEventListener("click",f),y.addEventListener("click",f),s.addEventListener("scroll",()=>{L=null}),window.addEventListener("resize",()=>{u.style.height=d.clientHeight+"px",g.style.height=a.clientHeight+"px"});const k=e=>{const t=e.selectionStart,n=e.value.slice(0,t).split("\n"),i=n.length;return{line:i,column:n[i-1].length}},H=16;u.addEventListener("click",()=>e(void 0,void 0,void 0,function*(){const e=k(u),{original:t,generated:n}=yield E("positionFromInput",e);L=t,d.innerHTML=o(u.value,t),a.innerHTML=o(g.value,n);const i=a.getElementsByClassName("highlight")[0];if(i){const e=i.getBoundingClientRect().top-a.getBoundingClientRect().top,t=r.clientHeight,n=r.scrollTop,l=n+t-H;(e<n||l<e)&&(r.scrollTop=e-.3*t)}})),g.addEventListener("click",()=>e(void 0,void 0,void 0,function*(){const e=k(g),{original:t,generated:n}=yield E("positionFromOutput",e);L=t,d.innerHTML=o(u.value,t),a.innerHTML=o(g.value,n);const i=d.getElementsByClassName("highlight")[0];if(i){const e=i.getBoundingClientRect().top-d.getBoundingClientRect().top,t=s.clientHeight,n=s.scrollTop,l=n+t-H;(e<n||l<e)&&(s.scrollTop=e-.3*t)}}))}();
